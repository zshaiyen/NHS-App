{% extends "base.html" %}

{% block content %}

<h2>Periods</h2>

{% if is_admin %}
<form method="POST" action="{{ url_for('periods') }}" id="periodForm">
  <div class="row mt-4">
    <div class="col-lg-2">
      <div class="form-floating mb-3">
        <input class="form-control" type="number" name="academic_year" id="academic_year" required>
        <label for="academic_year">Academic Year</label>
      </div>
    </div>

    <div class="col-lg-3">
      <div class="form-floating mb-3">
        <input class="form-control" type="text" name="period_name" id="period_name" required>
        <label for="period_name">Period Name</label>
      </div>
    </div>

    <div class="col-lg-2">
      <div class="form-floating mb-3">
        <input class="form-control" type="date" name="start_date" id="start_date" required>
        <label for="start_date">Start Date</label>
      </div>
    </div>

    <div class="col-lg-2">
      <div class="form-floating mb-3">
        <input class="form-control" type="date" name="end_date" id="end_date" required>
        <label for="end_date">End Date</label>
      </div>
    </div>

    <div class="col-lg-2">
      <div class="form-floating mb-3">
        <input class="btn btn-primary btn-lg shadow-sm" type="submit" style="width: 100%;" value="Add / Update Period">
      </div>
    </div>
  </div>
</form>

{% endif %}

<table class="table table-striped mt-4">
  <tr class="table-primary align=middle">
    <th>Academic Year</th>
    <th>Period Name</th>
    <th></th>
    <th>Start Date</th>
    <th>End Date</th>
    {% if is_admin %}
    <th>Notes</th>
    <th>Actions</th>
    {% endif %}
  </tr>
  {% for period in periods_rv %}
  <tr class="align-middle">
    <td {% if period['locked_flag']|int > 0 %}class="text-secondary"{% endif %}>
      {{ period['academic_year'] }}
    </td>
    <td {% if period['locked_flag']|int > 0 %}class="text-secondary"{% endif %}>
      {% if period['locked_flag']|int == 1 %}
      <span><i class="bi bi-lock-fill me-2"></i>{{ period['name'] }}</span>
      {% elif period['locked_flag']|int == 2 %}
      <span><i class="bi bi-ban text-danger me-2"></i>{{ period['name'] }}</span>
      {% elif period['locked_flag']|int == 0 %}
      <span class="text-dark"><i class="bi bi-unlock-fill text-warning me-2"></i>{{ period['name'] }}</span>
      {% endif %}
    </td>
    <td>
      {% if period['period_id']|int == earliest_period_id|int %}
        {% if is_admin %}  
        <a href="/lockperiod/{{ earliest_period_id }}" class="col-12 btn btn-danger btn-sm shadow-sm" role="button" onclick="return confirm('Are you sure you want to lock this period? You cannot undo this.')"><b>Lock Period</b></a>
        {% endif %}
      {% endif %}
    </td>
    <td {% if period['locked_flag']|int > 0 %}class="text-secondary"{% endif %}>
      {{ period['start_date'] }}
    </td>
    <td {% if period['locked_flag']|int > 0 %}class="text-secondary"{% endif %}>
      {{ period['end_date'] }}
    </td>
    {% if is_admin %}
    <td {% if period['locked_flag']|int > 0 %}class="text-secondary"{% endif %}>
      {% if period['no_required_hours_flag']|int == 1 %}
      No required hours
      {% endif %}
    </td>
    <td>
      <a href="{{ url_for('deleteperiod', period_id=period['period_id']) }}"
         class="btn btn-outline-danger btn-sm"
         onclick="return confirm('Are you sure you want to delete this period? This will delete all associated logs and signatures. This action cannot be undone.');">
         <i class="bi bi-trash-fill"></i> Delete
      </a>
    </td>
    {% endif %}
  </tr>
  {% endfor %}
</table>

{% endblock %}
